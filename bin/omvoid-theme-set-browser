#!/bin/bash

if [[ $1 == "wal" ]]; then
  CHROMIUM_THEME=~/.cache/wal/chromium.theme
else
  CHROMIUM_THEME=~/.config/omvoid/current/theme/chromium.theme
fi

if omvoid-cmd-present chromium || omvoid-cmd-present brave-browser-stable; then

  if [[ -f $CHROMIUM_THEME ]]; then
    rgb=$(<$CHROMIUM_THEME)
    THEME_HEX_COLOR=$(printf '#%02x%02x%02x' ${rgb//,/ })
  else
    # Use a default, neutral grey if theme doesn't have a color
    THEME_HEX_COLOR="#1c2027"
  fi

  if omvoid-cmd-present chromium; then 
     echo "{\"BrowserThemeColor\": \"$THEME_HEX_COLOR\"}" | tee "/etc/chromium/policies/managed/color.json" >/dev/null
    chromium --refresh-platform-policy --no-startup-window
  fi 
  
  if omvoid-cmd-present brave-browser-stable; then 
    echo "{\"BrowserThemeColor\": \"$THEME_HEX_COLOR\"}" | tee "/etc/brave/policies/managed/color.json" >/dev/null
    brave-browser-stable --refresh-platform-policy --no-startup-window
  fi
  
fi 

